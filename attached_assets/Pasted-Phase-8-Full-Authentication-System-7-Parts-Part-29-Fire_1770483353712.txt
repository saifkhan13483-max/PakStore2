Phase 8: Full Authentication System (7 Parts)
Part 29: Firebase Authentication Foundation and TypeScript Interfaces
Objective: Establish robust Firebase Authentication infrastructure with comprehensive TypeScript support and security configuration.

Update your existing /src/lib/firebase.ts file to include Firebase Authentication configuration. Import and initialize Firebase Auth using import { getAuth } from 'firebase/auth' and export the auth instance with export const auth = getAuth(app). Configure authentication providers by creating provider instances: GoogleAuthProvider for social login and set up proper OAuth configuration in Firebase Console including authorized domains and branding. Enable authentication methods in Firebase Console: Email/Password authentication for traditional signup, Google Sign-In provider with proper OAuth consent screen configuration including app name and logo, and Anonymous Authentication for guest user data persistence before registration. Create comprehensive TypeScript interfaces in /src/types/auth.ts defining AuthUser interface with properties (uid, email, displayName, photoURL, phoneNumber, emailVerified, createdAt, lastLoginAt, provider), AuthError interface with code and message fields for user-friendly error handling, AuthState interface tracking authentication status, and UserProfile interface for extended user data stored in Firestore (address, phoneNumber with Pakistani format, preferences). Configure Firestore security rules in Firebase Console protecting user data: allow authenticated users to read/write only their own documents under /users/{uid} path, implement validation rules ensuring data integrity and preventing malicious updates, and create rules for cart synchronization allowing users to access their own cart data. Set up environment variables in .env file for Firebase configuration using Vite's VITE_ prefix ensuring sensitive configuration is properly managed and never committed to version control.

Part 30: Authentication State Management with Zustand
Objective: Create centralized authentication state management integrating seamlessly with existing Zustand architecture and Firebase real-time updates.

Create authentication store in /src/store/authStore.ts using Zustand for consistency with existing cart store architecture. Define store state including user (AuthUser | null), isLoading (boolean for initialization state), isAuthenticated (computed boolean), and error (AuthError | null). Implement comprehensive store actions: setUser function updating user state and localStorage preferences, setLoading function managing loading states during authentication operations, setError function handling authentication errors with user-friendly messages, signOut function clearing user state and triggering cleanup, and clearError function resetting error state. Create Firebase integration layer within store using onAuthStateChanged listener automatically updating store when authentication state changes, mapping Firebase User object to AuthUser interface, handling authentication persistence across browser sessions, and managing loading states during Firebase initialization. Implement hybrid data synchronization: when user authenticates, trigger cart synchronization from localStorage to Firestore, merge guest cart data with existing user cart intelligently, update user's last login timestamp in Firestore, and sync user preferences and profile data. Add computed selectors for convenient access: isAuthenticated boolean derived from user state, userDisplayName with fallback to email, userInitials for avatar display, and canAccessProtectedRoutes checking authentication status. Create authentication provider component in /src/components/auth/AuthProvider.tsx wrapping application with authentication context, subscribing to Firebase auth state changes, and providing loading screen during initialization preventing flash of unauthenticated content.

Part 31: Authentication UI Components and Validation Schemas
Objective: Build reusable authentication components and comprehensive validation system optimized for Pakistani market requirements.

Create validation schemas in /src/lib/validations/auth.ts using Zod with Pakistani market considerations. Define loginSchema with email validation (required, proper email format) and password validation (required, minimum 6 characters). Create signupSchema with fullName validation (required, minimum 2 characters, letters and spaces only), email validation, password validation (required, minimum 8 characters, must contain uppercase, lowercase, number, and special character), confirmPassword validation (must match password), and optional terms acceptance. Implement profileSchema with Pakistani phone number validation using regex pattern ^(\+92|0|92)[0-9]{10}$ accepting formats like "+92 300 1234567," "0300 1234567," or "03001234567," address validation for Pakistani addresses, and city validation from predefined Pakistani cities list. Export TypeScript types using z.infer<typeof schemaName> for type safety throughout authentication components. Create AuthLayout component in /src/components/auth/AuthLayout.tsx providing consistent layout for all authentication pages. Design centered card layout with store logo, page title, subtitle, form content area, and footer links using shadcn Card component. Implement responsive design ensuring optimal display on mobile devices with proper spacing and touch-friendly interactions. Create SocialAuthButton component for Google Sign-In using official Google branding guidelines including proper logo, colors ("Continue with Google" text), and hover states. Add loading states with spinner and disabled state during authentication process. Create AuthError component displaying user-friendly error messages with proper styling using shadcn Alert component and icon indicators for different error types (validation errors, network errors, authentication failures).

Part 32: User Registration System with Multiple Authentication Methods
Objective: Implement comprehensive user registration supporting email/password and social authentication with proper validation and error handling.

Create Signup page component in /src/pages/auth/Signup.tsx using AuthLayout for consistent presentation. Implement registration form using React Hook Form integrated with Zod validation schema from Part 31. Create form fields using shadcn Form components: Full Name input with real-time validation, Email input with format checking and availability feedback, Password input with strength indicator showing weak/medium/strong based on complexity, Confirm Password input with real-time matching validation, and Terms & Conditions checkbox (required) linking to terms page. Add password visibility toggle using Lucide React eye icon allowing users to show/hide password for easier verification. Implement password strength indicator with visual feedback using color-coded progress bar (red for weak, yellow for medium, green for strong) and specific requirements checklist (uppercase, lowercase, number, special character). Create email/password registration handler calling Firebase's createUserWithEmailAndPassword, updating user profile with display name using updateProfile, creating user document in Firestore with profile information, triggering welcome email if email verification enabled, and redirecting to appropriate page after successful registration. Add Google Sign-In integration using signInWithPopup with GoogleAuthProvider, handling popup blocked scenarios gracefully, managing loading states during OAuth process, and creating user profile in Firestore for new Google users. Implement comprehensive error handling mapping Firebase error codes to user-friendly messages: "email-already-in-use" to "Account already exists with this email," "weak-password" to "Password should be at least 8 characters," and network errors to "Connection problem, please try again." Add success handling with toast notification, automatic redirect to intended destination or homepage, and cart synchronization for users who had items as guests. Ensure mobile optimization with proper keyboard types, adequate touch targets, and smooth animations between form states.

Part 33: User Login System with Session Management and Password Recovery
Objective: Create secure login system with multiple authentication options, session management, and password recovery functionality.

Create Login page component in /src/pages/auth/Login.tsx with clean, trust-building design emphasizing security and convenience. Implement login form using React Hook Form with simplified validation: email field (required, valid format) and password field (required, minimum length). Add "Remember Me" checkbox providing user control over session persistence (though Firebase handles persistence automatically, checkbox builds user trust and provides familiar UX pattern). Create email/password login handler using Firebase's signInWithEmailAndPassword with comprehensive error handling for common scenarios: invalid credentials ("Invalid email or password"), user not found ("No account found with this email"), too many requests ("Too many failed attempts, please try again later"), and network errors. Implement Google Sign-In option with same styling and functionality as signup page ensuring consistent user experience across authentication flows. Add redirect logic checking for intended destination: if user was redirected to login from protected route, return to that route after successful authentication; otherwise, redirect to homepage or user dashboard. Create "Forgot Password" functionality with modal or separate page containing email input field, implementing Firebase's sendPasswordResetEmail function, showing success message with instructions to check inbox including spam folder, and handling errors like user not found or too many requests gracefully. Add security features including rate limiting on failed login attempts (track attempts in component state, show temporary lockout message after 5 failed attempts), display of last successful login time after authentication for security awareness, and clear session management with automatic token refresh. Implement loading states throughout authentication process disabling form inputs during submission, showing spinner on submit buttons, and preventing multiple simultaneous authentication attempts. Ensure accessibility with proper ARIA labels, keyboard navigation support, and screen reader compatibility for all interactive elements.

Part 34: Protected Routes and Navigation Integration
Objective: Implement comprehensive route protection system and integrate authentication state throughout application navigation.

Create ProtectedRoute component in /src/components/auth/ProtectedRoute.tsx providing route-level authentication enforcement. Use authentication store to check user state: if isLoading is true, render full-screen loading skeleton preventing flash of redirect; if user not authenticated, redirect to login page using wouter's useLocation hook with return URL parameter (/login?redirect=/checkout) enabling return to intended destination after authentication; if authenticated, render children components normally. Integrate protected routes in /src/App.tsx wrapping sensitive pages: Checkout page, User Profile page, Order History page, and any other user-specific functionality ensuring only authenticated users can access. Update Header component to include authentication-aware navigation: for unauthenticated users, show "Sign In" and "Sign Up" links in appropriate locations; for authenticated users, display user menu with avatar or initials, dropdown containing Profile, Orders, and Sign Out options using shadcn DropdownMenu component. Implement user avatar display using user's profile photo if available or generated initials based on display name with consistent styling and proper fallback handling. Create sign out functionality in user menu triggering signOut from authentication store, clearing all user-related data including cart synchronization, showing confirmation toast, and redirecting to homepage with smooth transition. Add authentication status indicators throughout site: personalized welcome messages ("Welcome back, [Name]"), user-specific content like saved addresses in checkout, and authentication-gated features with appropriate prompts to sign in. Implement automatic cart synchronization when authentication state changes: when user signs in, merge localStorage cart with Firestore cart data preserving all items and using intelligent quantity resolution, show notification about merged items if applicable, and sync cart changes to Firestore in real-time for authenticated users. Handle edge cases like expired sessions, network connectivity issues during authentication checks, and proper cleanup when users sign out ensuring no sensitive data remains in browser storage.

Part 35: User Profile Management and Complete Cart Synchronization
Objective: Create comprehensive user profile management system and implement seamless cart synchronization between guest and authenticated states.

Create User Profile page component in /src/pages/auth/Profile.tsx as protected route displaying comprehensive user information and management options. Design profile sections: Account Information showing display name, email address, account creation date, last login timestamp, and authentication provider (password, Google); Contact Information with editable Pakistani phone number field using validation from Part 31, shipping address form with Pakistani cities dropdown, and emergency contact information; Account Security section with "Change Password" option (for email/password users), email verification status with resend verification option if needed, and account deletion option with proper confirmation flow. Implement profile editing functionality using React Hook Form with validation: create update handlers for display name, phone number, and address information; use Firebase's updateProfile for display name changes; sync all profile changes to Firestore user document maintaining data consistency; show success/error feedback with toast notifications; and implement optimistic updates for better user experience. Add email verification management: if user's email not verified, show prominent banner with verification status; implement email verification using Firebase's sendEmailVerification function; provide resend verification option with rate limiting; and show success messages with clear instructions. Create comprehensive cart synchronization system handling all authentication state transitions: when guest user signs in, fetch existing cart from Firestore if available, merge localStorage cart with Firestore cart using intelligent logic (preserve all unique items, use higher quantity for duplicate items, maintain item preferences), show user notification about merged items with summary, save merged cart to Firestore and clear localStorage, and update cart store with final merged data. Implement real-time cart synchronization for authenticated users: automatically sync cart changes to Firestore using Firestore listeners, handle offline scenarios with local persistence and sync when connection restored, resolve conflicts when same user makes changes on multiple devices, and provide user feedback for sync status and any conflicts. Add order history section (placeholder for future implementation) querying user's orders from Firestore, displaying order summaries with dates and totals, and providing links to detailed order views. Create account deletion functionality with proper confirmation flow: show warning about data loss and account recovery impossibility, require password confirmation for security, implement Firebase user deletion with cleanup of associated Firestore data, and provide export option for user data before deletion. Ensure mobile responsiveness with touch-friendly form elements, proper keyboard navigation, and optimized layout for various screen sizes throughout all profile management features.

Implementation Guidelines
Sequential Development: Complete these parts in order as each builds upon previous functionality. Part 29 establishes foundation, Parts 30-31 create infrastructure and components, Parts 32-33 implement core authentication flows, Part 34 integrates with existing application, and Part 35 adds advanced features and synchronization.

Testing Approach: After each part, thoroughly test implemented functionality: verify Firebase connections work correctly, test authentication flows with valid and invalid inputs, confirm protected routes redirect properly, validate cart synchronization across authentication states, and ensure mobile responsiveness and accessibility compliance.

Pakistani Market Optimization: Throughout implementation, maintain focus on local market needs: emphasize guest checkout availability for users hesitant to create accounts, implement Pakistani phone number validation accepting common local formats, provide clear privacy and security messaging building user trust, ensure authentication works reliably on slower network connections with proper offline handling, and include customer support contact information on authentication pages.

Security Best Practices: Implement comprehensive security measures: never expose Firebase private keys in client code using proper environment variable management, validate all user inputs on client side while relying on Firebase for server-side security, use HTTPS for all authentication operations (enforced by Firebase), implement proper Firestore security rules preventing unauthorized data access, and follow Firebase Authentication best practices for session management and password requirements.

User Experience Excellence: Prioritize exceptional user experience throughout authentication system: provide clear, helpful error messages without exposing security vulnerabilities, implement smooth loading states and transitions for all authentication operations, ensure forms are mobile-friendly with proper input types and touch targets, provide immediate feedback for user actions through toast notifications and visual confirmations, and maintain consistent design language with existing site components using established color scheme and typography.