You are a senior full‑stack engineer and technical SEO expert.
I have an e‑commerce SPA called PakCart and I want a dynamic sitemap endpoint so that when I add new products to Firestore, the sitemap updates automatically.

1. Project context (very important)
My app:

Type: Single Page Application (SPA), e‑commerce
Frontend: React 18 + Vite (TypeScript)
Routing: wouter
Styling: Tailwind CSS + shadcn/ui
State:
TanStack Query v5 (server state)
Zustand (auth + cart)
Backend/services:
Firebase Firestore (NoSQL)
Firebase Auth
Cloudinary for images
Deployment: Static hosting (e.g., Vercel / Replit Autoscale) with dist/ as build output.
Firestore collections (relevant for sitemap):

categories
Example fields:
slug: string (e.g., "electronics")
name: string
isActive: boolean
products
Example fields:
slug: string (e.g., "iphone-15-pro-max")
name: string
categorySlug: string (reference to categories.slug)
isActive: boolean
isFeatured: boolean
createdAt / updatedAt (Firestore Timestamp)
You can assume these fields exist or suggest a minimal structure as needed.

2. Sitemap requirements
I want you to design and implement a dynamic sitemap endpoint that:

Is accessible at:
https://www.my-pakcart-store.com/sitemap.xml
Automatically includes:
Homepage
Active category pages: /category/:categorySlug
Active product pages: /product/:productSlug
A few static info pages (e.g., /about, /contact, /faq, /shipping-returns)
Excludes:
Admin dashboard routes (e.g., /admin, /admin/products, /admin/orders)
Auth-only / private user pages (e.g., /account, /orders, /profile)
Cart / checkout pages (e.g., /cart, /checkout) if they’re not intended to rank
Uses proper XML sitemap structure:
XML header
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
One <url> per page with:
<loc>
<lastmod> (based on Firestore timestamps where available, or a sensible fallback)
<changefreq>:
Home: daily
Categories: daily or weekly
Products: weekly
Static info pages: monthly
<priority> (0.1–1.0):
Home: 1.0
Top categories: 0.8–0.9
Products: 0.5–0.7
Info pages: 0.4–0.6
Assume canonical domain:
https://www.my-pakcart-store.com

3. Hosting / implementation constraints
I’m using a Vite SPA with static hosting. I’m open to using a serverless function for the sitemap.

I want you to pick one of these concrete implementation targets and show the full solution for it:

Option A (preferred): Vercel serverless function (Node.js, TypeScript)
Located at api/sitemap.ts or similar
Deployed so that /sitemap.xml rewrites to that function
Option B: Netlify serverless function
Option C: Firebase Cloud Function (HTTP) that serves /sitemap.xml
Pick the option you think is cleanest and most common for a Vite SPA on Vercel, and explain how to wire it so /sitemap.xml hits that function.

You may assume I can store Firebase credentials as environment variables.

4. Firebase access details
You must:

Use Firebase Admin SDK or server‑side SDK to read from Firestore in the function.
Filter:
Only isActive === true categories
Only isActive === true products
Use updatedAt (or createdAt if updatedAt is missing) for <lastmod> when available.
Convert Firestore Timestamps to ISO strings: yyyy-MM-dd (date only is fine).
Show me how to:

Initialize Firebase Admin with service account credentials via environment variables.
Avoid initializing the app multiple times (typical pattern: check getApps().length).
5. What I want in your answer (structure)
Please structure your response in clear sections:

A. Architecture explanation (short)
Briefly describe:
How the dynamic sitemap endpoint works.
How it reads Firestore and returns XML.
How it keeps in sync when new products/categories are added.
B. Environment & config
Show example of required environment variables (e.g., FIREBASE_PROJECT_ID, FIREBASE_CLIENT_EMAIL, FIREBASE_PRIVATE_KEY or similar).
Explain where to put them (e.g., Vercel project settings).
Include any necessary package.json dependencies and minimal config.
C. Full code for the dynamic sitemap endpoint
Provide a complete, working TypeScript file for the chosen platform (for example, a Vercel function api/sitemap.ts):
Initialize Firebase Admin
Query categories and products
Build URL list (home, static pages, categories, products)
Generate valid XML string
Return it with Content-Type: application/xml
Code must be:
Copy‑paste ready
Strongly typed where reasonable
With comments explaining key parts
D. Routing / rewrites setup
Show how to map /sitemap.xml to that function:
For Vercel: sample vercel.json or config snippet (rewrites)
Or the equivalent for the chosen platform.
E. Optional: Enhancement tips
Brief notes on:
Adding robots.txt that references /sitemap.xml.
How often search engines will re‑fetch the sitemap.
How I could later split into multiple sitemaps if the product catalog gets very large.
6. Assumptions you can make
Use generic sample static pages:
/about
/contact
/faq
/shipping-returns
Use https://www.my-pakcart-store.com as the base domain in the code.
If a product or category is missing a slug, you can skip it in the sitemap.
You can assume Node 18+ runtime.
