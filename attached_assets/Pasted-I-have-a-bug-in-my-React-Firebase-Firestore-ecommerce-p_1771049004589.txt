I have a bug in my React + Firebase (Firestore) ecommerce project and need you to fully debug and fix it.

Project Context
The project is called Pakstore. It is a frontend-only, serverless e-commerce platform.

Stack / Architecture

React 18 with Vite
TypeScript
Routing: wouter
Styling: Tailwind + shadcn/ui
State:
TanStack Query v5 for server state (Firestore)
Zustand for client state (auth UI, cart, etc.)
Backend-as-a-Service:
Firebase Firestore (NoSQL) for data
Firebase Auth
Media: Cloudinary
Validation: Zod
No backend/server folder – everything is client-side. All Firestore interaction lives under client/src/services/ (e.g., firebase.ts, productService.ts or similar).
Data model types live in client/src/types/.
The part I’m having trouble with is category management (parent categories + sub‑categories) and their display in the site header.

The Actual Problems
On the “Manage Categories” page, I have Parent Categories and Sub‑Categories.

Parent: example Electronics & Gadgets
Sub‑category: example Power Banks
In the UI, when I edit the sub‑category, I can select a Parent Category (Electronics & Gadgets) in a dropdown and save.

But on the list view, the sub‑category still shows as “Unassigned” (or “Uncategorised”) instead of being recognized as under that parent category.

So the parent assignment is not being persisted or read correctly.

In the website header navigation, sub‑categories are not showing at all.

I expect something like:

Electronics & Gadgets
Power Banks (sub‑category)
etc.
But currently only parent categories (or maybe none) are shown there. Sub‑categories never appear in the header menu.

What I Think Is Going Wrong
Most likely, one or more of the following:

The sub‑category edit form is not saving the parent field correctly to Firestore (wrong field name or not included in the update).
The field name in Firestore (e.g. parentId vs parentCategoryId vs parentCategoryRef) doesn’t match:
the TypeScript type, and/or
the query / render logic in:
the “Manage Categories” page, and
the header navigation.
The header’s query or mapping logic is only using parent categories and never joins in / filters sub‑categories.
I need you to confirm exactly what’s wrong and then implement a clean fix.

What I Want You To Do
Please:

Find the relevant files
Search the repo for:

Components/pages like:
ManageCategories, CategoriesPage, CategoryManager, etc.
Anything that renders the “Parent Categories” / “Sub‑Categories” cards, including the “Unassigned” badge.
The sub‑category edit modal / form, e.g.:
EditSubCategoryDialog, SubCategoryForm, SubCategoryModal, etc.
Services for categories:
categoryService.ts, productService.ts, or similar.
Header/nav component:
Header.tsx, MainNav.tsx, Navbar.tsx, SiteHeader.tsx, etc., where category navigation is built.
Understand the data model

Open the TypeScript types (probably under client/src/types/):
Category, SubCategory, or similar interfaces.
Identify what field(s) are supposed to represent the relationship, e.g.:
parentCategoryId?: string | null
or parentId, parentSlug, parentRef, type: 'parent' | 'sub', etc.
Check the Zod schemas used for categories/sub‑categories and make sure the parent field is present there too.
Check Firestore access & documents

Inspect the Firestore collection(s) used for categories:
Are parent and sub‑categories in the same collection (categories) or separate ones (parentCategories, subCategories)?
Pick at least one sub‑category (e.g., “Power Banks”) and show me the actual Firestore document shape.
Verify whether a parent-related field is being written at all, and what its exact name and type are.
Debug the “Unassigned” label

Locate the UI code that renders “Unassigned” / “Uncategorised”.

Show me the condition, e.g.:

Copyif (!sub.parentCategoryId) return "Unassigned";
Compare that to:

the Firestore field name, and
the TypeScript properties in the query result.
Fix any mismatch. Examples of things you might need to do:

Ensure that when creating/updating a sub‑category, the code writes exactly the same field name that the UI expects (parentCategoryId or whatever we standardize on).
Align the Zod schema and mapping logic so TanStack Query returns the correct field to the components.
Fix the edit/create form behavior

In the sub‑category form component:
Make sure the select for parent category is bound to the correct form field (parentCategoryId or similar).
Ensure the onSubmit or handleSubmit passes that same value into the service call (e.g. updateSubCategory).
Confirm that editing an existing sub‑category with a parent:
pre-populates the dropdown with the current parent, and
after saving, the Firestore doc gets updated with the correct parent field.
Fix sub‑categories in the header navigation

Locate the header/menu component where categories are loaded.

Determine how it currently fetches categories, for example:

It might only query parent categories.
It might be using only documents where parentCategoryId == null as nav items.
Implement logic so:

For each parent category, its related sub‑categories are fetched (or filtered from one combined list) by comparing sub.parentCategoryId === parent.id.

The final data structure passed to the nav looks like:

Copytype NavCategory = {
  id: string;
  name: string;
  slug: string;
  subCategories: Array<{
    id: string;
    name: string;
    slug: string;
  }>;
};
And the JSX renders those sub‑categories as dropdown items or nested menu entries under the parent.

Ensure the Firestore queries are efficient and consistent with the rest of the app (use TanStack Query, same caching patterns, etc.).

Keep everything type‑safe

Update all relevant TypeScript types and Zod schemas so that:
The parent field is present and correctly typed.
There are no type errors after your changes.
Make sure any mapping/adapter layer between Firestore and the app types is updated consistently.
Validate the fix

Please actually run the app and verify:

Create or edit a sub‑category, assign it to a parent, click save.
Confirm in Firestore that the document has the correct parent field value.
Reload the Manage Categories page:
The sub‑category should NO LONGER show as “Unassigned”; it should be associated with the selected parent.
Reload the site header (main storefront pages):
The parent category should list its sub‑categories in the navigation.
Clicking a sub‑category should route to the correct URL (using the slug).
If there are legacy/unused fields or dead code paths causing confusion, please clean them up or comment clearly.

Explain the changes you make

When you’re done, summarize:

Which files you changed.
What field name we’re now using to represent the parent relation.
The root cause (e.g., “form saved parentId but UI expected parentCategoryId” or “header never used sub‑categories in its nav data structure”).
Any follow‑up steps or constraints I should know about.