üß© PART 1 ‚Äî Context & Problem Description (Profile Image)
You are an expert full‚Äëstack engineer with strong experience in Next.js / React, Firebase Auth, Firestore, and Cloudinary.

I have an ecommerce project with this stack:

Frontend: Next.js App Router (or React + Vite)
Styling: Tailwind CSS + Shadcn/UI
Auth: Firebase Authentication v9+ (modular SDK)
Database: Firestore
Media storage: Cloudinary (or Firebase Storage, depending on what you find)
Deployed on: Vercel
1. The Bug
On my Account Settings / Profile page, the user card looks like this screenshot:

https://www.genspark.ai/api/files/s/K1STkOqm

It shows the correct name and email.
But the profile image/avatar shows a placeholder with the text ‚ÄúFailed to load image‚Äù.
I am using Google Authentication, so the Firebase user should have a photoURL, or I may have a custom photo URL saved in Firestore / Cloudinary.
Your job is to fully debug and fix why the profile image is not loading and make sure avatars work reliably.

2. Repo and Files to Inspect
My repo:

<REPO_URL>
Root path in Replit (if not /): <PROJECT_PATH>
Please locate:

The Account Settings page/component:
e.g. app/account/settings/page.tsx, pages/account.tsx, components/AccountSettings.tsx, Profile.tsx, etc.
Any user profile card / avatar components:
e.g. UserAvatar.tsx, ProfileAvatar.tsx, AccountHeader.tsx, etc.
The authentication / user context:
e.g. authContext.tsx, useAuth.ts, lib/firebase.ts, useUser.ts, etc.
Any user document / profile collection in Firestore:
e.g. users/{uid}, profiles/{uid}.
Any code related to Cloudinary uploads for avatars, if present.
First, list the key files related to auth and account settings that you‚Äôll be working with.

üß© PART 2 ‚Äî Diagnose Data Source & Fix Profile Image Logic
In this part, I want you to trace where the profile image URL should come from, then fix the loading and fallback behavior.

1. Determine the Intended Source of the Profile Image
Please check:

How the current Account Settings page gets user data:

From Firebase Auth (currentUser.photoURL, displayName, etc.).
From a Firestore users document (e.g. users/{uid}.photoURL or avatarUrl).
From Cloudinary or some custom API.
Document the intended priority (you can infer it from code), e.g.:

Prefer: userProfile.photoURL from Firestore (custom avatar stored after upload).
Fallback: authUser.photoURL from Firebase Auth (Google profile picture).
Final fallback: Generated initials avatar or placeholder icon.
Explain in a short note what you discover.

2. Fix the Image URL & Rendering
Find the JSX where the profile image is rendered. It might look something like:

Copy<img src={user.photoURL} alt={user.name} />
or use a Shadcn/UI or Next.js <Image> component.

Ensure that:

The prop name is correct (src, not source).

For Next.js next/image, the code looks like:

Copyimport Image from "next/image";

<Image
  src={photoUrl}
  alt={userDisplayName || "User avatar"}
  width={96}
  height={96}
  className="rounded-full object-cover"
/>
If using Shadcn Avatar, confirm props:

Copy<Avatar>
  <AvatarImage src={photoUrl || ""} alt={userDisplayName || "User avatar"} />
  <AvatarFallback>{initials}</AvatarFallback>
</Avatar>
Fix common mistakes such as:

Using user.photoURL when user data actually lives under user.profileImage or user.avatarUrl.
Attempting to read from user.photoURL before user is loaded (rendering undefined or causing runtime errors).
Wrong field name from Firestore (e.g. profile_image vs profileImage vs photoURL).
Implement a robust selection logic:

Copyconst photoUrl =
  firestoreUser?.photoURL ||
  firestoreUser?.avatarUrl ||
  authUser?.photoURL ||
  null;
And then pass that to the avatar/image component.

Handle loading and missing cases:

While user data is loading, show a skeleton or placeholder.
If photoUrl is null or an empty string, let the Avatar fallback render initials instead of an empty/broken image.
3. Cloudinary / External Image Considerations
If you find code that uploads avatars to Cloudinary, verify:

The stored URL is a full HTTPS URL (e.g. https://res.cloudinary.com/...) and not a local temporary path.
The value saved in Firestore (photoURL / avatarUrl) is exactly the same URL that the <img> / <Image> component should use.
That this field is actually being read in the Account Settings page.
If the avatar is supposed to be loaded from Cloudinary but is still failing:

Check for:
Missing NEXT_PUBLIC_... Cloudinary env vars (only needed for uploads, usually not for direct display if URLs are stored).
Any URL transformation that might be incorrect.
Fix any obviously wrong URL composition, and prefer storing the final usable URL in Firestore.
üß© PART 3 ‚Äî Next.js Image Config, Fallbacks, and Final Summary
1. Next.js Image Configuration (If using next/image)
If the project uses Next.js and the Account Settings page uses <Image>:

Open next.config.js or next.config.mjs.

Ensure the images.domains config includes all domains that user avatars can come from, e.g.:

Copyconst nextConfig = {
  images: {
    domains: [
      "lh3.googleusercontent.com",  // Google OAuth photos
      "res.cloudinary.com",        // Cloudinary
      // add any other host used for profile images
    ],
  },
};

module.exports = nextConfig;
If this config is missing or incomplete, add/update the domains as needed.

Mention that after changing this file, a redeploy / rebuild is required for Vercel.

If the project is Vite/React and not using next/image, skip this step and just ensure normal <img src="..."> tags use valid URLs.

2. Better Fallback Behavior
Update the avatar component so that:

If the image fails to load (e.g. broken URL), we still show a decent fallback (initials, icon).

If using Shadcn Avatar, this is automatic if src is empty or broken.

Make sure AvatarFallback is something like:

Copyconst initials = userDisplayName
  ? userDisplayName
      .split(" ")
      .map((n) => n[0])
      .join("")
      .toUpperCase()
  : "U";

<AvatarFallback>{initials}</AvatarFallback>
Avoid showing literal text like ‚ÄúFailed to load image‚Äù in the UI.
If that text is hard‚Äëcoded anywhere, replace it with a user‚Äëfriendly fallback avatar.

3. Final Deliverables & Explanation for Me
When you are done, please provide:

A list of all files you changed. For example:

app/account/page.tsx or app/settings/page.tsx
components/AccountInformationCard.tsx
components/UserAvatar.tsx
lib/auth/useUser.ts
next.config.js
For the main Account Settings / avatar component, show:

Before: The old snippet where the profile image was failing.
After: The corrected version that:
Chooses the right URL field,
Handles loading/null gracefully,
Uses the proper Next.js or Shadcn props.
Briefly explain the root cause of the problem, such as:

Using the wrong property (user.photoURL vs user.profileImage).
Not including lh3.googleusercontent.com in Next.js images.domains.
Rendering the image before the user data exists.
Storing only a partial/invalid avatar URL.
Confirm the final behavior:

When a user logs in (e.g. with Google), the profile card shows:
Correct name,
Correct email,
A working profile picture (from Google or stored avatar).
If the user has no custom image or it fails:
A clean fallback avatar (initials/icon) is shown instead of ‚ÄúFailed to load image‚Äù.
No React/Next.js console errors appear on the account settings page.
This is the complete specification to debug and fix the profile image not showing issue on my Account Settings page.

